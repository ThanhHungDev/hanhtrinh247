function getHistoryChat(t,e,a){let n=SYSTEM_REAL_TIME_URL+("/api/admin/information-channels?refresh="+t+"&offset="+e+"&limit="+a);fetch(n,{method:"GET",headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{if(200==t.code){let e=handleDataChat(t.data);$('input[name="total-record"]').val(e.total),$('span[name="total-record"]').text(e.total),fillItemListHistoryChat(e.data,e.total,".c-table tbody")}else $(".c-table tbody").html("Error!")}).catch(t=>!1)}function handleDataChat(t){let e=0,a=[],n={data:a,total:0};if(t.total){e=t.total[0].count}if(t.channels){t.channels.forEach(function(e,n){let i=[],d=e.message,l=e.unread,r=e.user,o=e.backup;i.id=e.id,i.unread=l.length,i.last_send_date=d[0]?formatDate(d[0].createdAt,"Y-m-d H:i:s"):"",i.is_private=o,t.users&&t.users.forEach(function(t,e){r.includes(t.id.toString())&&(t.role_id==SYSTEM_ROLE_SITTER&&(i.name_sitter=t.first_name+""+t.last_name,i.id_sitter=t.id),t.role_id==SYSTEM_ROLE_EMPLOYER&&(i.name_emp=t.first_name+""+t.last_name,i.id_emp=t.id))}),i.link_chanel="message-reader/"+i.id_sitter+"/"+i.id,a.push(i)})}return n.data=a,n.total=e,n}function fillItemListHistoryChat(t,e,a){if(t){if(e<=0)return $(a).html("Nodata"),!1;$(a).html(""),t.forEach(function(t,e){appendItem(t,a)})}}function appendItem(t,e){$(".tr-default").find('input[data-type="input-public"]').removeAttr("checked"),$(".tr-default").find('span[data-type="unread"]').text(t.unread).removeClass("d-none"),$(".tr-default").find('td[data-type="name-sitter"]').text(t.name_sitter),$(".tr-default").find('td[data-type="name-emp"]').text(t.name_emp),$(".tr-default").find('td[data-type="last-mess"]').text(t.last_send_date),0==t.unread&&$(".tr-default").find('span[data-type="unread"]').addClass("d-none"),$(".tr-default").find('input[data-type="input-public"]').attr("id",t.id),$(".tr-default").find('label[data-type="label-public"]').attr("for",t.id),$(".tr-default").find('label[data-type="label-public"]').attr("data-id",t.id),$(".tr-default").find('label[data-type="label-public"]').text(SYSTEM_IS_PUBLIC),$(".tr-default").find('input[data-type="input-public"]').attr("checked",!0),!0===t.is_private&&($(".tr-default").find('label[data-type="label-public"]').text(SYSTEM_IS_PRIVATE),$(".tr-default").find('input[data-type="input-public"]').removeAttr("checked")),$(".tr-default").find('a[data-type="link"]').attr("href",t.link_chanel);let a=$("#tr-default table tbody").html();$(e).append(a)}function toggleChanel(t){let e=$(t).attr("data-id");$(t).attr("disabled","disabled"),handelChanel(REFRESH,e)}function handelChanel(t,e){let a={refresh:t,id:e},n=SYSTEM_REAL_TIME_URL+"/api/admin/toggle-channel";fetch(n,{method:"PUT",body:JSON.stringify(a),headers:{"Content-Type":"application/json"}}).then(t=>t.json()).then(t=>{if($("#"+e).removeAttr("disabled"),$('label[for="'+e+'"]').removeAttr("disabled"),200==t.code){let a=$('label[for="'+e+'"]');!0===t.data.backup?a.text(SYSTEM_IS_PRIVATE):a.text(SYSTEM_IS_PUBLIC)}else $.toast({heading:"Error!",text:"Update status error!",showHideTransition:"slide",icon:"error",position:"top-right"})}).catch(t=>!1)}function prevPage(){let t=(caculationPagination($('input[name="total-record"]').val(),LIMIT_RECORD,"prev")-1)*LIMIT_RECORD;getHistoryChat(REFRESH,t,LIMIT_RECORD)}function nextPage(){let t=(caculationPagination($('input[name="total-record"]').val(),LIMIT_RECORD,"next")-1)*LIMIT_RECORD;getHistoryChat(REFRESH,t,LIMIT_RECORD)}function caculationPagination(t,e,a){let n=Math.ceil(parseInt(t)/parseInt(e)),i=$('input[data-type="current"]'),d=i.val(),l=1;if("prev"==a){if(parseInt(d)-1<1)return l;l=parseInt(d)-1,i.val(l)}if("next"==a){if(n<=d)return l=parseInt(n),i.val(l),l;l=parseInt(d)+1,i.val(l)}return l}function formatDate(t,e){let a=new Date(t);switch(e){case"Y-m-d H:i:s":return formatted_date=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();default:return formatted_date=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()}}$(document).ready(function(){getHistoryChat(REFRESH,0,LIMIT_RECORD)});