function Calendar(){this.isCalendarSelector=!1,this.selector=null,this.inputEventData=null,this.dateLoop=1,this.dateLoopTemp=0,this.toDay=new Date,this.currentDate=this.toDay.getDate(),this.currentMonth=this.toDay.getMonth(),this.currentYear=this.toDay.getFullYear(),this.indexDate=new Date,this.selectDate=this.toDay.getDate(),this.selectMonth=this.toDay.getMonth(),this.selectYear=this.toDay.getFullYear(),this.firstDay=new Date(this.selectYear,this.selectMonth).getDay(),this.labelDays=["日","月","火","水","木","金","土"],this.labelYear="年",this.labelMonth="月",this.TEXT_PREV='<i class="fas fa-chevron-left"></i>',this.TEXT_NEXT='<i class="fas fa-chevron-right"></i>',this.data={},this.canPickDrag=!0,this.isDrag=!1,this.dragBegin=null,this.dragEnd=null,this.attributeDate="data-date",this.classWrapperCalendar="calendar-wrapper-calendar",this.classWrapperRowCell="calendar-wrapper-row-cell",this.classRow="calendar-row",this.classInToday="calendar-today",this.classInSunday="calendar-sunday",this.classInSatday="calendar-satday",this.classHeader="calendar-header",this.classTitleDay="calendar-title-day",this.classBody="calendar-body",this.classFooter="calendar-footer",this.classCell="calendar-cell",this.classCellDisable="calendar-cell-disable",this.classPicked="calendar-picked",this.classCellDate="calendar-cell-date",this.classNext="calendar-next",this.classPrev="calendar-prev",this.classCellEvent="calendar-event",this.classCellHasEvent="calendar-has-event",this.classModal="calendar-modal",this.classModalHeader="calendar-modal-header",this.classModalClose="calendar-modal-close",this.classModalBody="calendar-modal-body",this.classModalFooter="calendar-modal-footer",this.classModalBodyTitle="calendar-modal-body-title",this.wrapperCheckBox="calendar--wrapper__checkbox",this.wrapperInput="calendar--wrapper__input",this.idModalTextTime="js-modal-header__text",this.idModalCalendar="js-modal-calendar",this.idModalHourBegin="js-hour-begin",this.idModalHourEnd="js-hour-end",this.idModalMinuteBegin="js-minute-begin",this.idModalMinuteEnd="js-minute-end",this.idModalCheckFirst="js-modal-check-first",this.idModalCheckLast="js-modal-check-last",this.idModalButtonNew="js-modal-button-new",this.idModalButtonEdit="js-modal-button-edit",this.idModalButtonDelete="js-modal-button-delete",this.idModalButtonTimeClose="js-modal-button-time-close",this.idModalButtonGotoChat="js-modal-button-chat",this.typeNumber="number",this.nameModalHourBegin="hour_begin",this.nameModalHourEnd="hour_end",this.nameModalMinuteBegin="minute_begin",this.nameModalMinuteEnd="minute_end",this.createModal=null,this.eventBeforeOpenModel=null,this.eventAfterOpenModel=null,this.setBeforeOpenModel=function(t){this.eventBeforeOpenModel=t},this.setAfterOpenModel=function(t){this.eventAfterOpenModel=t},this.setCreateModel=function(t){this.createModal=t},this.setLabelDays=function(t){this.labelDays=t},this.setLabelMonth=function(t){this.labelMonth=t},this.setLabelYear=function(t){this.labelYear=t},this.setCurrentDay=function(t){this.toDay=t,this.currentDate=this.toDay.getDate(),this.currentMonth=this.toDay.getMonth(),this.currentYear=this.toDay.getFullYear(),this.firstDay=new Date(this.selectYear,this.selectMonth).getDay()},this.setSelectIndexDay=function(t){this.indexDate=t,this.selectDate=this.indexDate.getDate(),this.selectMonth=this.indexDate.getMonth(),this.selectYear=this.indexDate.getFullYear(),this.firstDay=new Date(this.selectYear,this.selectMonth).getDay()},this.setSelectMonth=function(t){this.indexDate=new Date(this.selectYear,t,1),this.selectDate=this.indexDate.getDate(),this.selectMonth=this.indexDate.getMonth(),this.selectYear=this.indexDate.getFullYear(),this.firstDay=new Date(this.selectYear,this.selectMonth).getDay()},this.setSelectYear=function(t){this.indexDate=new Date(t,this.selectMonth,1),this.selectDate=this.indexDate.getDate(),this.selectMonth=this.indexDate.getMonth(),this.selectYear=this.indexDate.getFullYear(),this.firstDay=new Date(this.selectYear,this.selectMonth).getDay()},this.setNewCalendarSelector=function(t){this.isCalendarSelector=t},this.setElementDraw=function(t){this.selector=t},this.numDayInMonth=function(t,e){return 32-new Date(e,t,32).getDate()},this.setEventData=function(t){this.data=t},this.setInputEventData=function(t){this.inputEventData=t},this.formatZeroBefore=function(t){return t=parseInt(t),isNaN(t)?"00":(t<10&&(t="0"+t),t)},this.checkToday=function(){return this.dateLoop===this.currentDate&&this.selectYear===this.currentYear&&this.selectMonth===this.currentMonth},this.checkSunDay=function(){var t=this.dateLoop;return 0==new Date(this.selectYear,this.selectMonth,t).getDay()},this.checkSatDay=function(){var t=this.dateLoop;return 6==new Date(this.selectYear,this.selectMonth,t).getDay()},this.leftThanToday=function(){return new Date(this.selectYear,this.selectMonth,this.dateLoop).getTime()<new Date(this.currentYear,this.currentMonth,this.currentDate).getTime()},this.setPickDrag=function(t){this.canPickDrag=t},this.createHeader=function(){var t=this,e=document.createElement("div");e.className=this.classHeader;var a=document.createElement("span");a.className=this.classPrev,a.innerHTML=this.TEXT_PREV,a.onclick=function(){t.setSelectMonth(t.selectMonth-1),t.draw()},e.appendChild(a);var s=document.createElement("span");s=document.createTextNode(this.selectYear+this.labelYear+" "+(this.selectMonth+1)+this.labelMonth+" "),e.appendChild(s);var i=document.createElement("span");return i.className=this.classNext,i.innerHTML=this.TEXT_NEXT,i.onclick=function(){t.setSelectMonth(t.selectMonth+1),t.draw()},e.appendChild(i),e},this.pickData=function(t){$("."+t.classPicked).removeClass(t.classPicked);let e=parseInt(t.dragBegin),a=parseInt(t.dragEnd);if(parseInt(e)>parseInt(a)){let t=parseInt(e);e=parseInt(a),a=t}for(let s=e;s<=a;s++){$("."+t.classCell+"["+t.attributeDate+"="+s+"]:not(."+t.classCellDisable+")").addClass(t.classPicked)}},this.createEventDrag=function(t,e){return window.innerWidth<768?(e.ontouchstart=function(e){if(3!==e.which){t.isDrag=!0;var a=$(e.target);a.hasClass(t.classCell)||(a=a.closest("."+t.classCell)),a&&a.attr(t.attributeDate)&&(t.dragBegin=a.attr(t.attributeDate),t.dragEnd=a.attr(t.attributeDate),console.log("ontouchstart cell ",t.dragBegin),t.pickData(t))}},e.ontouchmove=function(e){if(t.isDrag){var a=$(e.target);a.hasClass(t.classCell)||(a=a.closest("."+t.classCell)),a&&a.attr(t.attributeDate)&&(t.dragEnd=a.attr(t.attributeDate),console.log(e,"ontouchmove cell "+t.dragEnd),t.pickData(t))}},e.ontouchend=function(e){if(3!==e.which){t.isDrag=!1;var a=$(e.target);a.hasClass(t.classCell)||(a=a.closest("."+t.classCell)),a&&a.attr(t.attributeDate)&&(t.dragEnd=a.attr(t.attributeDate),console.log(e,"ontouchend cell "+t.dragEnd),t.pickData(t))}}):(e.onmousedown=function(e){if(3!==e.which){t.isDrag=!0;var a=$(e.target);a.hasClass(t.classCell)||(a=a.closest("."+t.classCell)),a&&a.attr(t.attributeDate)&&(t.dragBegin=a.attr(t.attributeDate),t.dragEnd=a.attr(t.attributeDate),t.pickData(t))}},e.onmouseover=function(e){if(t.isDrag){var a=$(e.target);a.hasClass(t.classCell)||(a=a.closest("."+t.classCell)),a&&a.attr(t.attributeDate)&&(t.dragEnd=a.attr(t.attributeDate),t.pickData(t))}},e.onmouseup=function(e){if(3!==e.which){t.isDrag=!1;var a=$(e.target);a.hasClass(t.classCell)||(a=a.closest("."+t.classCell)),a&&a.attr(t.attributeDate)&&(t.dragEnd=a.attr(t.attributeDate),t.pickData(t))}}),e},this.checkDateHaveEvent=function(t,e,a){return void 0!==this.data[t]&&void 0!==this.data[t][e]&&void 0!==this.data[t][e][a]},this.overrideEvent=function(t,e){e.class="event-new";for(var a=0;a<t.length;a++){var s=t[a],i=this.formatZeroBefore(s),n=this.formatZeroBefore(this.selectMonth+1),l=this.formatZeroBefore(this.selectYear);this.data&&(0===Object.entries(this.data).length&&(this.data={}),null==this.data[l]&&(this.data[l]={}),null==this.data[l][n]&&(this.data[l][n]={}),this.data[l][n][i]=e)}this.draw()},this.updateEvent=function(t,e){e.class="event-update";var a=this.formatZeroBefore(t),s=this.formatZeroBefore(this.selectMonth+1),i=this.formatZeroBefore(this.selectYear);this.data&&(this.checkDateHaveEvent(i,s,a)&&(this.data[i][s][a]=e));this.draw()},this.deleteEvent=function(t){var e=this.formatZeroBefore(t),a=this.formatZeroBefore(this.selectMonth+1),s=this.formatZeroBefore(this.selectYear);this.data&&(this.checkDateHaveEvent(s,a,e)&&(delete this.data[s][a][e],Object.keys(this.data[s][a]).length||delete this.data[s][a],Object.keys(this.data[s]).length||delete this.data[s]));this.draw()},this.drawEventToDate=function(t,e){var a=this.formatZeroBefore(e.getDate()),s=this.formatZeroBefore(e.getMonth()+1),i=this.formatZeroBefore(e.getFullYear());if(this.data){var n="",l="";if(this.checkDateHaveEvent(i,s,a)){var d=this.data[i][s][a];n="<i>"+d.start+"</i><i> | </i><i>"+d.finish+"</i>",t.classList.add(this.classCellHasEvent),l=d.class}var o=document.createElement("span");o.innerHTML=n,o.classList.add(this.classCellEvent),l&&o.classList.add(l),t.appendChild(o)}return t},this.createCell=function(t,e){var a=document.createElement("div");if(a.className=this.classCell,0===t&&e<this.firstDay&&0==this.dateLoopTemp){a.classList.add(this.classCellDisable);var s=new Date(this.selectYear,this.selectMonth,1);s.setDate(s.getDate()-this.firstDay+e),(i=document.createElement("span")).className=this.classCellDate,i.innerHTML=s.getDate(),a.appendChild(i),a.setAttribute(this.attributeDate,s.getDate()),a=this.drawEventToDate(a,s)}else if(1==this.dateLoopTemp||this.dateLoop>this.numDayInMonth(this.selectMonth,this.selectYear)){0==this.dateLoopTemp&&(this.dateLoopTemp=1,this.dateLoop=1),a.classList.add(this.classCellDisable),(i=document.createElement("span")).className=this.classCellDate,i.innerHTML=this.dateLoop,a.appendChild(i),a.setAttribute(this.attributeDate,this.dateLoop),a=this.drawEventToDate(a,new Date(this.selectYear,this.selectMonth+1,this.dateLoop)),this.dateLoop++}else{var i;this.canPickDrag&&(a=this.createEventDrag(this,a)),(i=document.createElement("span")).className=this.classCellDate,i.innerHTML=this.dateLoop,a.appendChild(i),a.setAttribute(this.attributeDate,this.dateLoop),a=this.drawEventToDate(a,new Date(this.selectYear,this.selectMonth,this.dateLoop)),this.isCalendarSelector&&this.leftThanToday()&&a.classList.add(this.classCellDisable),this.checkToday()&&a.classList.add(this.classInToday),this.checkSunDay()&&a.classList.add(this.classInSunday),this.checkSatDay()&&a.classList.add(this.classInSatday),this.dateLoop++}return a},this.createCells=function(){var t=document.createElement("div"),e=document.createElement("div");e.className=this.classTitleDay;for(var a=0;a<this.labelDays.length;a++){var s=document.createElement("div");s.className=this.classCell;var i=document.createElement("span");i.className=this.classCellDate,i.innerHTML=this.labelDays[a],s.appendChild(i),e.appendChild(s)}t.appendChild(e);var n=document.createElement("div");n.className=this.classWrapperRowCell;for(let t=0;t<6;t++){var l=document.createElement("div");l.className=this.classRow;for(let e=0;e<7;e++){var d=this.createCell(t,e);l.appendChild(d)}n.appendChild(l)}return t.appendChild(n),this.dateLoop=1,this.dateLoopTemp=0,t},this.createFooter=function(){var t=document.createElement("div");t.className=this.classFooter;var e=document.createElement("SPAN");e.innerHTML="予約可能";var a=document.createElement("SPAN");return a.innerHTML="一部の日程・時間で可能",t.appendChild(e),t.appendChild(a),t},this.newModalPopup=function(t){if(this.isCalendarSelector&&document.getElementById(this.idModalCalendar)){document.getElementById(this.idModalCalendar).classList.add("new"),this.selector.classList.add("modal-open"),document.getElementById(this.idModalButtonNew).classList.remove("d-none"),document.getElementById(this.idModalButtonEdit).classList.add("d-none"),document.getElementById(this.idModalButtonDelete).classList.add("d-none");var e=document.getElementById(this.idModalTextTime);e&&(t[0]==t[t.length-1]?e.innerHTML=this.selectMonth+1+"月"+t[0]+"日(火)":e.innerHTML=this.selectMonth+1+"月"+t[0]+"日(火) - "+(this.selectMonth+1)+"月"+t[t.length-1]+"日(火)")}},this.updateModalPopup=function(t){if(this.isCalendarSelector){if(1==t.length){var e=t[0],a=this.formatZeroBefore(e),s=this.formatZeroBefore(this.selectMonth+1),i=this.formatZeroBefore(this.selectYear),n=this.data[i][s][a];starts=n.start.split(":"),hourStart=starts[0],minStart=starts[1],ends=n.finish.split(":"),hourEnd=ends[0],minEnd=ends[1];var l=document.getElementById(this.idModalCheckFirst),d=document.getElementById(this.idModalCheckLast);l.checked=n.type&&-1!=n.type.indexOf(",1,"),d.checked=n.type&&-1!=n.type.indexOf(",2,"),document.getElementById(this.idModalHourBegin).value=hourStart,document.getElementById(this.idModalMinuteBegin).value=minStart,document.getElementById(this.idModalHourEnd).value=hourEnd,document.getElementById(this.idModalMinuteEnd).value=minEnd;var o=document.getElementById(this.idModalTextTime);o&&(o.innerHTML=a+"月"+s+"日(火)")}document.getElementById(this.idModalCalendar)&&(this.selector.classList.add("modal-open"),document.getElementById(this.idModalCalendar).classList.add("update"),document.getElementById(this.idModalButtonNew).classList.add("d-none"),document.getElementById(this.idModalButtonEdit).classList.remove("d-none"),document.getElementById(this.idModalButtonDelete).classList.remove("d-none"))}},this.modelClose=function(){var t=document.getElementById(this.idModalCalendar);t&&t.classList.add("d-none"),this.isCalendarSelector&&(document.getElementById(this.idModalCalendar)&&(this.selector.classList.remove("modal-open"),document.getElementById(this.idModalCalendar).classList.remove("new"),document.getElementById(this.idModalCalendar).classList.remove("update"),document.getElementById(this.idModalButtonNew).classList.add("d-none"),document.getElementById(this.idModalButtonEdit).classList.add("d-none"),document.getElementById(this.idModalButtonDelete).classList.add("d-none")),this.inputEventData&&(this.inputEventData.value=JSON.stringify(this.data)))},this.openModalCreateEvent=function(t){var e=null;this.setBeforeOpenModel&&(e=this.eventBeforeOpenModel(t));var a=!1;if(e&&e.length&&1==e.length){var s=e[0];this.data&&this.checkDateHaveEvent(this.formatZeroBefore(this.selectYear),this.formatZeroBefore(this.selectMonth+1),this.formatZeroBefore(s))&&(a=!0)}a?this.updateModalPopup(e):this.newModalPopup(e),document.getElementById(this.idModalCalendar).classList.remove("d-none"),this.setAfterOpenModel&&e&&this.eventAfterOpenModel(t,e)},this.draw=function(){var t=document.createElement("div");t.className=this.classWrapperCalendar;var e=this.createHeader();t.appendChild(e);var a=this.createCells();t.appendChild(a);var s=this.createFooter(),i=null;if(this.createModal&&(i=this.createModal(this),t.appendChild(i)),this.selector&&(this.selector.innerHTML="",this.selector.appendChild(t),this.selector.appendChild(s)),this.canPickDrag){var n=this;window.innerWidth<767?window.ontouchend=function(t){if(console.log("21323123 ontouchend"),3===t.which)return;n.isDrag=!1;let e=n.classPicked;if(document.getElementsByClassName(e).length){var a=document.getElementById(n.idModalCalendar);a&&a.classList.contains("d-none")&&n.openModalCreateEvent(n)}}:window.onmouseup=function(t){if(3===t.which)return;n.isDrag=!1;let e=n.classPicked;if(document.getElementsByClassName(e).length){var a=document.getElementById(n.idModalCalendar);a&&a.classList.contains("d-none")&&n.openModalCreateEvent(n)}}}}}